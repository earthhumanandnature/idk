<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishingwiththemath</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
    </style>

    <style>
        @keyframes slideUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        .music-disc {
            animation: spin 3s linear infinite;
            animation-play-state: paused;
        }
        .music-disc.playing {
            animation-play-state: running;
        }
        
        /* Music Player Styles */
        .music-player {
            position: fixed;
            bottom: 16px;
            left: 16px;
            background: linear-gradient(to bottom right, #9333ea, #ec4899);
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 16px;
            z-index: 1000;
            color: white;
            transition: all 0.3s;
        }
        
        .music-player.collapsed {
            width: 64px;
            height: 64px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .music-player.expanded {
            width: 384px;
        }
        
        .music-player input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        }
        
        .music-player input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .music-player input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .music-player button {
            transition: all 0.2s;
        }
        
        .music-player button:hover {
            transform: scale(1.05);
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="musicPlayer" class="music-player collapsed" style="display: none;">
        <div id="collapsedView" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 32px;">
            üéµ
        </div>
        <div id="expandedView" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="font-weight: bold; font-size: 18px;">üéµ Music Player</h3>
                <button id="collapseBtn" style="color: white; background: none; border: none; cursor: pointer; font-size: 16px;">‚ñº</button>
            </div>
            
            <div style="display: flex; justify-content: center; margin-bottom: 16px;">
                <div id="musicDisc" class="music-disc" style="width: 128px; height: 128px; border-radius: 50%; background: linear-gradient(to bottom right, #fbbf24, #ec4899); display: flex; align-items: center; justify-content: center; border: 4px solid white; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: #1f2937;"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 16px;">
                <p id="trackName" style="font-weight: bold;">No Music</p>
                <p id="trackInfo" style="font-size: 14px; opacity: 0.8;">Track 0 / 0</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <input type="range" id="progressBar" min="0" max="100" value="0" style="width: 100%;">
                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 4px;">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            
            <div style="display: flex; justify-content: center; align-items: center; gap: 16px; margin-bottom: 16px;">
                <button id="prevBtn" style="background: rgba(255,255,255,0.2); border: none; border-radius: 50%; padding: 8px; cursor: pointer; font-size: 20px;">‚èÆÔ∏è</button>
                <button id="playBtn" style="background: white; color: #9333ea; border: none; border-radius: 50%; padding: 12px; cursor: pointer; font-size: 24px;">‚ñ∂Ô∏è</button>
                <button id="nextBtn" style="background: rgba(255,255,255,0.2); border: none; border-radius: 50%; padding: 8px; cursor: pointer; font-size: 20px;">‚è≠Ô∏è</button>
            </div>
            
            <div style="margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 14px;">üîä</span>
                    <input type="range" id="volumeBar" min="0" max="100" value="50" style="flex: 1;">
                    <span id="volumeText" style="font-size: 14px; width: 40px;">50%</span>
                </div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 14px;">‚ö°</span>
                    <input type="range" id="speedBar" min="50" max="200" value="100" step="25" style="flex: 1;">
                    <span id="speedText" style="font-size: 14px; width: 40px;">1x</span>
                </div>
            </div>
            
            <div style="display: flex; justify-content: center;">
                <button id="loopBtn" style="padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; background: white; color: #9333ea;">
                    üîÑ Loop ON
                </button>
            </div>
        </div>
    </div>
    
    <audio id="audioElement" preload="metadata"></audio>
    
    <div id="root"></div>

    <script>
        (function() {
            // Music Player Variables
            let playlist = [];
            let currentTrackIndex = 0;
            let isPlaying = false;
            let loop = true;
            
            const audio = document.getElementById('audioElement');
            const musicPlayer = document.getElementById('musicPlayer');
            const collapsedView = document.getElementById('collapsedView');
            const expandedView = document.getElementById('expandedView');
            const musicDisc = document.getElementById('musicDisc');
            const playBtn = document.getElementById('playBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const loopBtn = document.getElementById('loopBtn');
            const collapseBtn = document.getElementById('collapseBtn');
            const progressBar = document.getElementById('progressBar');
            const volumeBar = document.getElementById('volumeBar');
            const speedBar = document.getElementById('speedBar');
            const currentTimeEl = document.getElementById('currentTime');
            const totalTimeEl = document.getElementById('totalTime');
            const volumeText = document.getElementById('volumeText');
            const speedText = document.getElementById('speedText');
            const trackName = document.getElementById('trackName');
            const trackInfo = document.getElementById('trackInfo');
            
            // Format time helper
            function formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return mins + ':' + (secs < 10 ? '0' : '') + secs;
            }
            
            // Check available music files
            async function checkMusicFiles() {
                const available = [];
                for (let i = 1; i <= 10; i++) {
                    const filename = 'music' + i + '.mp3';
                    try {
                        const response = await fetch(filename, { method: 'HEAD' });
                        if (response.ok) {
                            available.push({
                                id: i,
                                name: 'Music ' + i,
                                src: filename
                            });
                        }
                    } catch (error) {
                        // File doesn't exist, skip
                    }
                }
                return available;
            }
            
            // Initialize player
            async function initPlayer() {
                playlist = await checkMusicFiles();
                
                if (playlist.length > 0) {
                    musicPlayer.style.display = 'block';
                    loadTrack(0);
                    updateUI();
                    
                    // Auto expand
                    setTimeout(toggleExpand, 500);
                    
                    // Auto play after 1 second
                    setTimeout(() => {
                        togglePlay();
                    }, 1000);
                }
            }
            
            // Load track
            function loadTrack(index) {
                if (index < 0 || index >= playlist.length) return;
                currentTrackIndex = index;
                audio.src = playlist[index].src;
                updateUI();
            }
            
            // Update UI
            function updateUI() {
                if (playlist.length > 0) {
                    trackName.textContent = playlist[currentTrackIndex].name;
                    trackInfo.textContent = 'Track ' + (currentTrackIndex + 1) + ' / ' + playlist.length;
                }
                
                playBtn.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
                
                if (isPlaying) {
                    musicDisc.classList.add('playing');
                } else {
                    musicDisc.classList.remove('playing');
                }
                
                loopBtn.textContent = loop ? 'üîÑ Loop ON' : 'üîÑ Loop OFF';
                loopBtn.style.background = loop ? 'white' : 'rgba(255,255,255,0.2)';
                loopBtn.style.color = loop ? '#9333ea' : 'white';
            }
            
            // Toggle play/pause
            function togglePlay() {
                if (isPlaying) {
                    audio.pause();
                    isPlaying = false;
                } else {
                    audio.play().catch(e => console.log('Play error:', e));
                    isPlaying = true;
                }
                updateUI();
            }
            
            // Skip to next track
            function skipNext() {
                const nextIndex = (currentTrackIndex + 1) % playlist.length;
                loadTrack(nextIndex);
                if (isPlaying) {
                    audio.play();
                }
            }
            
            // Skip to previous track
            function skipPrev() {
                const prevIndex = currentTrackIndex === 0 ? playlist.length - 1 : currentTrackIndex - 1;
                loadTrack(prevIndex);
                if (isPlaying) {
                    audio.play();
                }
            }
            
            // Toggle loop
            function toggleLoop() {
                loop = !loop;
                updateUI();
            }
            
            // Expand/collapse player
            function toggleExpand() {
                if (musicPlayer.classList.contains('collapsed')) {
                    musicPlayer.classList.remove('collapsed');
                    musicPlayer.classList.add('expanded');
                    collapsedView.style.display = 'none';
                    expandedView.style.display = 'block';
                } else {
                    musicPlayer.classList.add('collapsed');
                    musicPlayer.classList.remove('expanded');
                    collapsedView.style.display = 'flex';
                    expandedView.style.display = 'none';
                }
            }
            
            // Event Listeners
            playBtn.addEventListener('click', togglePlay);
            nextBtn.addEventListener('click', skipNext);
            prevBtn.addEventListener('click', skipPrev);
            loopBtn.addEventListener('click', toggleLoop);
            collapseBtn.addEventListener('click', toggleExpand);
            collapsedView.addEventListener('click', toggleExpand);
            
            // Progress bar
            progressBar.addEventListener('input', function() {
                const time = (this.value / 100) * audio.duration;
                audio.currentTime = time;
            });
            
            // Volume bar
            volumeBar.addEventListener('input', function() {
                const vol = this.value / 100;
                audio.volume = vol;
                volumeText.textContent = this.value + '%';
            });
            
            // Speed bar
            speedBar.addEventListener('input', function() {
                const speed = this.value / 100;
                audio.playbackRate = speed;
                speedText.textContent = speed + 'x';
            });
            
            // Audio events
            audio.addEventListener('timeupdate', function() {
                if (audio.duration) {
                    const progress = (audio.currentTime / audio.duration) * 100;
                    progressBar.value = progress;
                    currentTimeEl.textContent = formatTime(audio.currentTime);
                }
            });
            
            audio.addEventListener('loadedmetadata', function() {
                totalTimeEl.textContent = formatTime(audio.duration);
            });
            
            audio.addEventListener('ended', function() {
                if (loop) {
                    skipNext();
                } else {
                    if (currentTrackIndex === playlist.length - 1) {
                        isPlaying = false;
                        updateUI();
                    } else {
                        skipNext();
                    }
                }
            });
            
            // Initialize on page load
            let playerInitialized = false;
            
            window.addEventListener('load', function() {
                // Check if Firebase auth is available
                if (window.firebase && window.firebase.auth) {
                    window.firebase.auth().onAuthStateChanged(function(user) {
                        if (user && !playerInitialized) {
                            // User is logged in, initialize music player
                            playerInitialized = true;
                            initPlayer();
                        } else if (!user) {
                            // User is logged out, hide music player
                            musicPlayer.style.display = 'none';
                            if (isPlaying) {
                                audio.pause();
                                isPlaying = false;
                                updateUI();
                            }
                        }
                    });
                }
            });
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ‚ö†Ô∏è THAY ƒê·ªîI CONFIG N√ÄY B·∫∞NG FIREBASE CONFIG C·ª¶A B·∫†N
        const firebaseConfig = {
          apiKey: "AIzaSyAdRj_aTtKC4EpctQtiJymTPI5TIhXEQTU",
          authDomain: "fishing-game-b3de4.firebaseapp.com",
          projectId: "fishing-game-b3de4",
          storageBucket: "fishing-game-b3de4.firebasestorage.app",
          messagingSenderId: "995387752934",
          appId: "1:995387752934:web:ccb5c73999a23d7715d627",
          measurementId: "G-2BYJH3JMTZ"
        };

        // Kh·ªüi t·∫°o Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        const FishIcon = ({ size = 24, color = "#000" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                <path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-1 3.46-3.44 6-7 6s-7.56-2.54-8.5-6Z"/>
                <path d="M18 12v.5M16 17.5a2 2 0 0 0 2-2"/>
                <path d="M20 12c0-.5 0-1-.09-1.5"/>
            </svg>
        );

        const PackageIcon = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/>
                <path d="m3.3 7 8.7 5 8.7-5M12 22V12"/>
            </svg>
        );

        const FishingGame = () => {
            const [gameState, setGameState] = useState('login');
            const [loginMode, setLoginMode] = useState('login');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [currentUser, setCurrentUser] = useState(null);
            const [userId, setUserId] = useState(null);
            const [currentFish, setCurrentFish] = useState(null);
            const [answer, setAnswer] = useState('');
            const [timeLeft, setTimeLeft] = useState(0);
            const [inventory, setInventory] = useState([]);
            const [showInventory, setShowInventory] = useState(false);
            const [inventoryTab, setInventoryTab] = useState('fish');
            const [message, setMessage] = useState('');
            const [money, setMoney] = useState(0);
            const [showSellConfirm, setShowSellConfirm] = useState(false);
            const [loading, setLoading] = useState(false);
            const [showShop, setShowShop] = useState(false);
            const [shopTab, setShopTab] = useState('rods');
            const [fishingRod, setFishingRod] = useState('normal');
            const [ownedRods, setOwnedRods] = useState(['normal']);
            const [currentBait, setCurrentBait] = useState('normal');
            const [ownedBaits, setOwnedBaits] = useState(['normal']);
            const [configError, setConfigError] = useState(false);
            const [showLeaderboard, setShowLeaderboard] = useState(false);
            const [leaderboardTab, setLeaderboardTab] = useState('fish');
            const [leaderboardData, setLeaderboardData] = useState([]);
            const [loadingLeaderboard, setLoadingLeaderboard] = useState(false);
            // State cho nhi·ªám v·ª• h·∫±ng ng√†y
            const [dailyQuests, setDailyQuests] = useState([]);
            const [showQuests, setShowQuests] = useState(false);
            const [lastQuestReset, setLastQuestReset] = useState(null);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [adminCommand, setAdminCommand] = useState('');
            const [adminOutput, setAdminOutput] = useState('');
            const [displayMoney, setDisplayMoney] = useState(0);
            const [moneyChange, setMoneyChange] = useState(0);
            const [showMoneyChange, setShowMoneyChange] = useState(false);
            const [isBanned, setIsBanned] = useState(false);
            // ‚≠ê TH√äM STATE LOGS
            const [showLogs, setShowLogs] = useState(false);
            const [logsData, setLogsData] = useState([]);
            const [loadingLogs, setLoadingLogs] = useState(false);

            const rarities = [
                { name: 'Common', weight: 60, range: 10, time: 3, color: '#9CA3AF', price: 10 },
                { name: 'Uncommon', weight: 50, range: 20, time: 5, color: '#22C55E', price: 25 },
                { name: 'Rare', weight: 30, range: 30, time: 6, color: '#3B82F6', price: 50 },
                { name: 'Legendary', weight: 20, range: 40, time: 8, color: '#A855F7', price: 75 },
                { name: 'Mythic', weight: 10, range: 50, time: 9, color: '#EF4444', price: 100 },
                { name: 'Secret', weight: 1, range: 60, time: 10, color: '#F59E0B', price: 150 },
                { name: 'Special(admin)', weight: 0, range: 0, time: 0, color: '#FFD700', price: NaN }
            ];

            // Format s·ªë ti·ªÅn
            const formatMoney = (amount) => {
                if (amount >= 1000000000) return `${(amount / 1000000000).toFixed(1)}b`;
                if (amount >= 1000000) return `${(amount / 1000000).toFixed(1)}m`;
                if (amount >= 1000) return `${(amount / 1000).toFixed(1)}k`;
                return amount.toString();
            };

            // C·∫≠p nh·∫≠t ti·ªÅn v·ªõi animation
            const updateMoneyWithAnimation = (newAmount, change) => {
                // Gi·ªõi h·∫°n t·ªëi ƒëa 1b
                const limitedAmount = Math.min(newAmount, MAX_MONEY);
                const actualChange = limitedAmount - money;
    
                if (actualChange !== 0) {
                    setMoneyChange(actualChange);
                    setShowMoneyChange(true);
        
                    setTimeout(() => {
                        setShowMoneyChange(false);
                    }, 2000);
                }
    
                setMoney(limitedAmount);
            };

            // Gi·ªõi h·∫°n ti·ªÅn t·ªëi ƒëa
            const MAX_MONEY = 1000000000; // 1 t·ª∑

            const isAdmin = currentUser === 'vvt158214@gmail.com';

            const fishNames = {
                'Common': ['C√° R√¥', 'C√° Ch√©p', 'C√° Tr√™', 'C√° L√≥c'],
                'Uncommon': ['C√° H·ªìi', 'C√° Ng·ª´', 'C√° Chim', 'C√° Basa'],
                'Rare': ['C√° Ki·∫øm', 'C√° M·∫≠p Nh·ªè', 'C√° Voi Con', 'C√° Heo'],
                'Legendary': ['C√° M·∫≠p Tr·∫Øng', 'C√° Voi Xanh', 'C√° S·∫•u', 'C√° R·ªìng'],
                'Mythic': ['C√° R·ªìng V√†ng', 'C√° Ph∆∞·ª£ng Ho√†ng', 'C√° K·ª≥ L√¢n', 'Leviathan'],
                'Secret': ['C√° Th·∫ßn', 'Poseidon', 'Kraken', 'C√° R·ªìng C·ªï ƒê·∫°i'],
                'Special(admin)':['Tralalelo Tralala', 'Trippi Troppi Troppa Trippa(shirm)', 'Trippi Troppi Troppa Trippa(frog)']
            };

            const baitInfo = {
                'normal': {
                    name: 'Normal Bait',
                    description: 'M·ªìi c√¢u th√¥ng th∆∞·ªùng',
                    icon: 'ü™±',
                    color: '#9CA3AF',
                    difficulty: {
                        'Common': 0, 'Uncommon': 0, 'Rare': 0,
                        'Legendary': 0, 'Mythic': 0, 'Secret': 0,
                        'Special(admin)':0
                    }
                },
                'fish': {
                    name: 'Fish Bait',
                    description: 'Gi·∫£m ƒë·ªô kh√≥ b√†i to√°n',
                    icon: 'üêü',
                    color: '#22C55E',
                    price: 200,
                    difficulty: {
                        'Common': 20, 'Uncommon': 15, 'Rare': 10,
                        'Legendary': 5, 'Mythic': 2, 'Secret': 1,
                        'Special(admin)':0

                    }
                },
                'update': {
                    name: 'Update Bait',
                    description: 'Gi·∫£m ƒë√°ng k·ªÉ ƒë·ªô kh√≥',
                    icon: 'ü¶ê',
                    color: '#3B82F6',
                    price: 400,
                    difficulty: {
                        'Common': 40, 'Uncommon': 35, 'Rare': 30,
                        'Legendary': 25, 'Mythic': 20, 'Secret': 10,
                        'Special(admin)':0
                    }
                },
                'secret': {
                    name: 'Secret Bait',
                    description: 'Gi·∫£m c·ª±c k·ª≥ nhi·ªÅu ƒë·ªô kh√≥',
                    icon: 'ü¶ë',
                    color: '#A855F7',
                    price: 700,
                    difficulty: {
                        'Common': 80, 'Uncommon': 75, 'Rare': 70,
                        'Legendary': 65, 'Mythic': 60, 'Secret': 55,
                        'Special(admin)':0
                    }
                }
            };

            // C·∫•u h√¨nh nhi·ªám v·ª• h·∫±ng ng√†y
            const dailyQuestTemplates = [
                {
                    id: 'catch_fish',
                    type: 'catch',
                    title: 'C√¢u c√°',
                    description: 'C√¢u ƒë∆∞·ª£c {target} con c√° b·∫•t k·ª≥',
                    target: 5,
                    reward: 50,
                    icon: 'üé£'
                },
                {
                    id: 'catch_rare',
                    type: 'catch_rare',
                    title: 'Th·ª£ sƒÉn Rare',
                    description: 'C√¢u ƒë∆∞·ª£c {target} con c√° Rare tr·ªü l√™n',
                    target: 3,
                    reward: 100,
                    icon: '‚≠ê'
                },
                {
                    id: 'solve_math',
                    type: 'solve',
                    title: 'Cao th·ªß to√°n h·ªçc',
                    description: 'Gi·∫£i ƒë√∫ng {target} b√†i to√°n',
                    target: 10,
                    reward: 75,
                    icon: 'üßÆ'
                },
                {
                    id: 'earn_money',
                    type: 'earn',
                    title: 'Ki·∫øm ti·ªÅn',
                    description: 'Ki·∫øm ƒë∆∞·ª£c {target} xu',
                    target: 200,
                    reward: 100,
                    icon: 'üí∞'
                },
                {
                    id: 'catch_legendary',
                    type: 'catch_legendary',
                    title: 'Huy·ªÅn tho·∫°i',
                    description: 'C√¢u ƒë∆∞·ª£c {target} con c√° Legendary tr·ªü l√™n',
                    target: 1,
                    reward: 200,
                    icon: 'üèÜ'
                }
            ];

            const shopItems = [
                {
                    id: 'legendary_rod',
                    name: 'New Rank Fish!',
                    description: 'Gi√∫p b·∫°n c√¢u ƒë∆∞·ª£c c√° Legendary',
                    price: 300,
                    color: 'bg-green-600 hover:bg-green-700',
                    unlocks: 'legendary'
                },
                {
                    id: 'mythic_rod',
                    name: 'Mythical Fishing Rod',
                    description: 'Gi√∫p b·∫°n c√¢u ƒë∆∞·ª£c c√° Mythic',
                    price: 500,
                    color: 'bg-red-600 hover:bg-red-700',
                    unlocks: 'mythic'
                },
                {
                    id: 'secret_rod',
                    name: 'Mysterious Fishing Rod',
                    description: 'Gi√∫p b·∫°n c√¢u ƒë∆∞·ª£c c√° Secret',
                    price: 700,
                    color: 'bg-gray-900 hover:bg-gray-800',
                    unlocks: 'secret'
                }
            ];

            const executeAdminCommand = async () => {
                if (!isAdmin) {
                    setAdminOutput('‚ùå B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠ d·ª•ng l·ªánh n√†y!');
                    return;
                }

                const parts = adminCommand.trim().split(' ');
                const command = parts[0].toLowerCase();

                try {
                    if (command === '/givefish') {
                        if (parts.length < 3) {
                            setAdminOutput('‚ùå C√∫ ph√°p: /givefish <t√™n c√°> <email>');
                            return;
                        }

                        const fishName = parts.slice(1, -1).join(' ');
                        const targetEmail = parts[parts.length - 1];
                        const usersSnapshot = await db.collection('users').where('email', '==', targetEmail).get();
                        
                        if (usersSnapshot.empty) {
                            setAdminOutput(`‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: ${targetEmail}`);
                            return;
                        }

                        const targetUserId = usersSnapshot.docs[0].id;
                        let fishRarity = 'Common';
                        let fishColor = '#9CA3AF';
                        let basePrice = 10;
                        
                        for (const [rarity, names] of Object.entries(fishNames)) {
                            if (names.some(name => name.toLowerCase() === fishName.toLowerCase())) {
                                fishRarity = rarity;
                                const rarityData = rarities.find(r => r.name === rarity);
                                fishColor = rarityData?.color || '#9CA3AF';
                                basePrice = rarityData?.price || 10;
                                break;
                            }
                        }

                        // ‚≠ê T√çNH C√ÇN N·∫∂NG NG·∫™U NHI√äN GI·ªêNG KHI C√ÇU
                        let weight = 1.0;
                        let increaseChance = 1.0;
                        while (Math.random() < increaseChance) {
                            weight += 0.1;
                            increaseChance -= 0.001;
                        }
                        weight = Math.round(weight * 10) / 10;

                        // ‚≠ê T√çNH GI√Å THEO C√ÇN N·∫∂NG
                        const fishPrice = Math.round(basePrice * weight);

                        await db.collection('users').doc(targetUserId).collection('inventory').add({
                            name: fishName,
                            rarity: fishRarity,
                            weight: weight,
                            price: fishPrice,
                            color: fishColor,
                            favourite: false,
                            caughtAt: firebase.firestore.FieldValue.serverTimestamp(),
                            adminGiven: true
                        });

                        setAdminOutput(`‚úÖ ƒê√£ t·∫∑ng "${fishName}" (${weight}kg, ${fishPrice} xu) cho ${targetEmail}`);
                        saveLog('admin_give_fish', { fish: fishName, weight, target: targetEmail }, fishPrice);

                    } else if (command === '/ban') {
                        if (parts.length !== 2) {
                            setAdminOutput('‚ùå C√∫ ph√°p: /ban <email>');
                            return;
                        }
                        const targetEmail = parts[1];
                        const usersSnapshot = await db.collection('users').where('email', '==', targetEmail).get();
                        if (usersSnapshot.empty) {
                            setAdminOutput(`‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: ${targetEmail}`);
                            return;
                        }
                        const targetUserId = usersSnapshot.docs[0].id;
                        await db.collection('users').doc(targetUserId).update({ banned: true });
                        setAdminOutput(`‚úÖ ƒê√£ ban ${targetEmail}`);
                        saveLog('admin_ban', { target: targetEmail }, 0);
                        
                    } else if (command === '/unban') {
                        if (parts.length !== 2) {
                            setAdminOutput('‚ùå C√∫ ph√°p: /unban <email>');
                            return;
                        }
                        const targetEmail = parts[1];
                        const usersSnapshot = await db.collection('users').where('email', '==', targetEmail).get();
                        if (usersSnapshot.empty) {
                            setAdminOutput(`‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: ${targetEmail}`);
                            return;
                        }
                        const targetUserId = usersSnapshot.docs[0].id;
                        await db.collection('users').doc(targetUserId).update({ banned: false });
                        setAdminOutput(`‚úÖ ƒê√£ unban ${targetEmail}`);
                        saveLog('admin_unban', { target: targetEmail }, 0);
                
                    } else if (command === '/givemoney') {
                        if (parts.length !== 3) {
                            setAdminOutput('‚ùå C√∫ ph√°p: /givemoney <s·ªë xu> <email>');
                            return;
                        }

                        const amount = parseInt(parts[1]);
                        const targetEmail = parts[2];

                        if (isNaN(amount)) {
                            setAdminOutput('‚ùå S·ªë xu ph·∫£i l√† s·ªë!');
                            return;
                        }

                        const usersSnapshot = await db.collection('users').where('email', '==', targetEmail).get();
                        
                        if (usersSnapshot.empty) {
                            setAdminOutput(`‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: ${targetEmail}`);
                            return;
                        }

                        const targetUserId = usersSnapshot.docs[0].id;
                        const userData = usersSnapshot.docs[0].data();
                        const newMoney = (userData.money || 0) + amount;

                        await db.collection('users').doc(targetUserId).update({ money: newMoney });

                        setAdminOutput(`‚úÖ ƒê√£ t·∫∑ng ${amount} xu cho ${targetEmail}`);
                        saveLog('admin_give_money', { amount, target: targetEmail }, amount);

                    } else if (command === '/giverod') {
                        if (parts.length !== 3) {
                            setAdminOutput('‚ùå C√∫ ph√°p: /giverod <legendary|mythic|secret> <email>');
                            return;
                        }

                        const rodType = parts[1].toLowerCase();
                        const targetEmail = parts[2];

                        if (!['legendary', 'mythic', 'secret'].includes(rodType)) {
                            setAdminOutput('‚ùå Lo·∫°i c·∫ßn kh√¥ng h·ª£p l·ªá! (legendary, mythic, secret)');
                            return;
                        }

                        const usersSnapshot = await db.collection('users').where('email', '==', targetEmail).get();
                        
                        if (usersSnapshot.empty) {
                            setAdminOutput(`‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i: ${targetEmail}`);
                            return;
                        }

                        const targetUserId = usersSnapshot.docs[0].id;
                        const userData = usersSnapshot.docs[0].data();
                        const ownedRods = userData.ownedRods || ['normal'];

                        if (!ownedRods.includes(rodType)) {
                            ownedRods.push(rodType);
                            await db.collection('users').doc(targetUserId).update({ ownedRods });
                            setAdminOutput(`‚úÖ ƒê√£ t·∫∑ng c·∫ßn c√¢u ${rodType} cho ${targetEmail}`);
                        } else {
                            setAdminOutput(`‚ö†Ô∏è ${targetEmail} ƒë√£ c√≥ c·∫ßn c√¢u ${rodType}`);
                            saveLog('admin_give_rod', { rod: rodType, target: targetEmail }, 0);

                    } else if (command === '/help') {
                        setAdminOutput(`
                        üìã Danh s√°ch l·ªánh Admin:
                        ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
                        /givefish <t√™n c√°> <email>
                          ‚Üí T·∫∑ng c√° cho B·∫§T K·ª≤ ng∆∞·ªùi ch∆°i n√†o
                          ‚Üí VD: /givefish C√° R·ªìng player@gmail.com

                        /givemoney <s·ªë xu> <email>
                          ‚Üí T·∫∑ng xu cho B·∫§T K·ª≤ ng∆∞·ªùi ch∆°i n√†o  
                          ‚Üí VD: /givemoney 1000 player@gmail.com

                        /giverod <legendary|mythic|secret> <email>
                          ‚Üí T·∫∑ng c·∫ßn c√¢u cho B·∫§T K·ª≤ ng∆∞·ªùi ch∆°i n√†o
                          ‚Üí VD: /giverod mythic player@gmail.com
                          
                        /ban <email>
                          ‚Üí Ban b·∫•t ng∆∞·ªùi ch∆°i n√†o
                          ‚Üí VD: /ban player@gmail.com

                        /unban <email>
                          ‚Üí UNBan b·∫•t ng∆∞·ªùi ch∆°i n√†o
                          ‚Üí VD: /unban player@gmail.com

                        /help - Hi·ªÉn th·ªã tr·ª£ gi√∫p
                        ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
                        ‚úÖ B·∫°n c√≥ th·ªÉ give cho M·ªåI email, kh√¥ng ch·ªâ admin!
                        `);

                    } else {
                        setAdminOutput('‚ùå L·ªánh kh√¥ng h·ª£p l·ªá! G√µ /help ƒë·ªÉ xem danh s√°ch l·ªánh.');
                    }

                } catch (error) {
                    setAdminOutput(`‚ùå L·ªói: ${error.message}`);
                }
            };

            // Ki·ªÉm tra Firebase config
            useEffect(() => {
                if (firebaseConfig.apiKey === "Idk") {
                    setConfigError(true);
                }
            }, []);

            // Animation s·ªë ti·ªÅn ch·∫°y
            useEffect(() => {
                if (displayMoney !== money) {
                    const diff = money - displayMoney;
                    const step = diff / 20; // Chia th√†nh 20 b∆∞·ªõc
        
                    const interval = setInterval(() => {
                        setDisplayMoney(prev => {
                            const next = prev + step;
                            // N·∫øu ƒë√£ g·∫ßn ƒë·∫øn s·ªë cu·ªëi th√¨ set lu√¥n
                            if (Math.abs(money - next) < Math.abs(step)) {
                                clearInterval(interval);
                                return money;
                            }
                            return next;
                        });
                    }, 30); // M·ªói 30ms update 1 l·∫ßn
        
                    return () => clearInterval(interval);
                }
            }, [money]);

            // L·∫Øng nghe tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
            // L·∫Øng nghe tr·∫°ng th√°i ƒëƒÉng nh·∫≠p (FIX BAN)
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        setUserId(user.uid);
                        setCurrentUser(user.email);
            
                        // ‚≠ê KI·ªÇM TRA BAN TR∆Ø·ªöC KHI LOAD DATA
                        const gameDoc = await db.collection('users').doc(user.uid).get();
                        if (gameDoc.exists && gameDoc.data().banned === true) {
                            setGameState('banned');
                            return; // D·ª™NG, KH√îNG LOAD DATA
                        }
            
                        // Kh√¥ng banned ‚Üí load b√¨nh th∆∞·ªùng
                        await loadGameData(user.uid);
                        setGameState('menu');
                    } else {
                        setGameState('login');
                    }
                });
                return () => unsubscribe();
            }, []);

            // Auto-save game data
            useEffect(() => {
                if (userId && gameState === 'menu') {
                    const saveTimer = setTimeout(() => {
                        saveGameData();
                    }, 2000);
                    return () => clearTimeout(saveTimer);
                }
            }, [money, fishingRod, ownedRods, currentBait, ownedBaits, userId]);

            const loadGameData = async (uid) => {
                try {
                    const gameDoc = await db.collection('users').doc(uid).get();
                    if (gameDoc.exists) {
                        const data = gameDoc.data();
                        setMoney(data.money || 0);
                        setFishingRod(data.fishingRod || 'normal');
                        setOwnedRods(data.ownedRods || ['normal']);
                        setCurrentBait(data.currentBait || 'normal');
                        setOwnedBaits(data.ownedBaits || ['normal']);
                    }

                    const inventorySnapshot = await db.collection('users').doc(uid).collection('inventory').get();
                    const fishList = inventorySnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setInventory(fishList);
        
                    // Load nhi·ªám v·ª• h·∫±ng ng√†y
                    await checkAndResetQuests(uid);
                } catch (error) {
                    console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                }
            };

            // Kh·ªüi t·∫°o nhi·ªám v·ª• h·∫±ng ng√†y
            const initializeDailyQuests = () => {
                const quests = dailyQuestTemplates.map(template => ({
                    ...template,
                    progress: 0,
                    completed: false,
                    claimed: false
                }));
                return quests;
            };

            // Ki·ªÉm tra v√† reset nhi·ªám v·ª• n·∫øu qua ng√†y m·ªõi
            const checkAndResetQuests = async (uid) => {
                try {
                    const questDoc = await db.collection('users').doc(uid).collection('quests').doc('daily').get();
        
                    if (questDoc.exists) {
                        const questData = questDoc.data();
                        const lastReset = questData.lastReset ? questData.lastReset.toDate() : new Date(0);
                        const today = new Date();
            
                        // Ki·ªÉm tra xem ƒë√£ qua ng√†y m·ªõi ch∆∞a
                        if (lastReset.toDateString() !== today.toDateString()) {
                            // Reset nhi·ªám v·ª•
                            const newQuests = initializeDailyQuests();
                            await db.collection('users').doc(uid).collection('quests').doc('daily').set({
                                quests: newQuests,
                                lastReset: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            setDailyQuests(newQuests);
                            setLastQuestReset(today);
                        } else {
                            // Load nhi·ªám v·ª• hi·ªán t·∫°i
                            setDailyQuests(questData.quests || []);
                            setLastQuestReset(lastReset);
                        }
                    } else {
                        // T·∫°o nhi·ªám v·ª• l·∫ßn ƒë·∫ßu
                        const newQuests = initializeDailyQuests();
                        await db.collection('users').doc(uid).collection('quests').doc('daily').set({
                            quests: newQuests,
                            lastReset: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        setDailyQuests(newQuests);
                        setLastQuestReset(new Date());
                    }
                } catch (error) {
                    console.error('L·ªói khi ki·ªÉm tra nhi·ªám v·ª•:', error);
                }
            };

            // C·∫≠p nh·∫≠t ti·∫øn ƒë·ªô nhi·ªám v·ª•
            const updateQuestProgress = async (questType, amount = 1, rarityName = '') => {
                if (!userId || dailyQuests.length === 0) return;
    
                let updated = false;
                const newQuests = dailyQuests.map(quest => {
                    if (quest.completed) return quest;
        
                    let shouldUpdate = false;
        
                    switch (quest.type) {
                        case 'catch':
                            shouldUpdate = questType === 'catch';
                            break;
                        case 'catch_rare':
                            shouldUpdate = questType === 'catch' && ['Rare', 'Legendary', 'Mythic', 'Secret'].includes(rarityName);
                            break;
                        case 'catch_legendary':
                            shouldUpdate = questType === 'catch' && ['Legendary', 'Mythic', 'Secret'].includes(rarityName);
                            break;
                        case 'solve':
                            shouldUpdate = questType === 'solve';
                            break;
                        case 'earn':
                            shouldUpdate = questType === 'earn';
                            break;
                    }
        
                    if (shouldUpdate) {
                        updated = true;
                        const newProgress = Math.min(quest.progress + amount, quest.target);
                        return {
                            ...quest,
                            progress: newProgress,
                            completed: newProgress >= quest.target
                        };
                    }
        
                    return quest;
                });
    
                if (updated) {
                    setDailyQuests(newQuests);
        
                    // L∆∞u v√†o Firebase
                    try {
                        await db.collection('users').doc(userId).collection('quests').doc('daily').update({
                            quests: newQuests
                        });
                    } catch (error) {
                        console.error('L·ªói khi c·∫≠p nh·∫≠t nhi·ªám v·ª•:', error);
                    }
                }
            };

            // Nh·∫≠n th∆∞·ªüng nhi·ªám v·ª•
            const claimQuestReward = async (questId) => {
                const quest = dailyQuests.find(q => q.id === questId);

                if (!quest || !quest.completed || quest.claimed) {
                    return;
                }

                const newMoney = money + quest.reward;
                const newQuests = dailyQuests.map(q => 
                    q.id === questId ? { ...q, claimed: true } : q
                );

                updateMoneyWithAnimation(newMoney, quest.reward); // ‚Üê Thay ƒë·ªïi
                // ‚≠ê TH√äM LOG QUEST
                saveLog('quest_reward', { quest: quest.title, reward: quest.reward }, quest.reward);
                setDailyQuests(newQuests);

                try {
                    await db.collection('users').doc(userId).update({ money: Math.min(newMoney, MAX_MONEY) });
                    await db.collection('users').doc(userId).collection('quests').doc('daily').update({
                        quests: newQuests
                    });

                    setMessage(`üéâ ƒê√£ nh·∫≠n th∆∞·ªüng ${formatMoney(quest.reward)} xu!`);
                    setTimeout(() => setMessage(''), 3000);
                } catch (error) {
                    console.error('L·ªói khi nh·∫≠n th∆∞·ªüng:', error);
                }
            };

            const saveGameData = async () => {
                if (!userId) return;
                try {
                    await db.collection('users').doc(userId).set({
                        money,
                        fishingRod,
                        ownedRods,
                        currentBait,
                        ownedBaits,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                } catch (error) {
                    console.error('L·ªói khi l∆∞u:', error);
                }
            };

            // ‚≠ê H√ÄM L∆ØU LOG (G·ªåI T·ª™ C√ÅC EVENT)
            const saveLog = async (action, details = {}, amount = 0) => {
                if (!userId) return;
                try {
                    await db.collection('logs').add({
                        action,
                        userEmail: currentUser,
                        details,
                        amount,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('L·ªói l∆∞u log:', error);
                }
            };

            // ‚≠ê FORMAT MESSAGE LOGS
            const formatLogMessage = (log) => {
                const d = log.details || {};
                switch (log.action) {
                    case 'catch_fish':
                        return `${d.name || 'C√°'} (${d.weight || 0}kg, ${d.rarity || 'Unknown'})`;
                    case 'buy_rod':
                        return `Mua c·∫ßn c√¢u "${d.rod || 'Unknown'} (${d.price || 0} xu)`;
                    case 'buy_bait':
                        return `Mua m·ªìi "${d.bait || 'Unknown'} (${d.price || 0} xu)`;
                    case 'sell_fish':
                        return `B√°n ${d.count || 0} c√° (nh·∫≠n ${d.total || 0} xu)`;
                    case 'quest_reward':
                        return `Nh·∫≠n th∆∞·ªüng nhi·ªám v·ª• "${d.quest || 'Unknown'} (${d.reward || 0} xu)"`;
                    case 'admin_give_fish':
                        return `Admin t·∫∑ng c√° "${d.fish || 'Unknown'} (${d.weight || 0}kg)"`;
                    case 'admin_give_money':
                        return `Admin t·∫∑ng ${d.amount || 0} xu`;
                    case 'admin_give_rod':
                        return `Admin t·∫∑ng c·∫ßn "${d.rod || 'Unknown'}";`;
                    case 'admin_ban':
                        return `Admin BAN user "${d.target || ''}"`;
                    case 'admin_unban':
                        return `Admin UNBAN user "${d.target || ''}"`;
                    default:
                        return 'Ho·∫°t ƒë·ªông kh√°c';
                }
            };

            const loadLeaderboard = async () => {
               setLoadingLeaderboard(true);
               try {
                   // L·∫•y d·ªØ li·ªáu t·∫•t c·∫£ ng∆∞·ªùi ch∆°i
                   const usersSnapshot = await db.collection('users').get();
                   const leaderboard = [];

                   for (const userDoc of usersSnapshot.docs) {
                       const userData = userDoc.data();
            
                       // ƒê·∫øm s·ªë c√° c·ªßa ng∆∞·ªùi ch∆°i
                       const inventorySnapshot = await db.collection('users')
                           .doc(userDoc.id)
                           .collection('inventory')
                           .get();
            
                       const fishCount = inventorySnapshot.size;
            
                       leaderboard.push({
                           id: userDoc.id,
                           email: userData.email || 'Anonymous',
                           money: userData.money || 0,
                           fishCount: fishCount
                       });
                   }

                   setLeaderboardData(leaderboard);
               } catch (error) {
                   console.error('L·ªói khi t·∫£i b·∫£ng x·∫øp h·∫°ng:', error);
               } finally {
                   setLoadingLeaderboard(false);
               }
           };

            // ‚≠ê LOAD LOGS 24H QUA & X√ìA C≈®
            const loadLogs = async () => {
                setLoadingLogs(true);
                try {
                    const now = firebase.firestore.Timestamp.now();
                    const yesterday = new firebase.firestore.Timestamp(now.seconds - 86400, now.nanoseconds); // 24h ago

                    // Query logs m·ªõi
                    const newSnapshot = await db.collection('logs')
                        .where('timestamp', '>', yesterday)
                        .orderBy('timestamp', 'desc')
                        .limit(200)  // Max 200 logs g·∫ßn nh·∫•t
                        .get();

                    // X√ìA LOGS C≈® H∆†N 24H (AUTO CLEAN)
                    const oldSnapshot = await db.collection('logs')
                        .where('timestamp', '<=', yesterday)
                        .get();
                    if (!oldSnapshot.empty) {
                        const batch = db.batch();
                        oldSnapshot.docs.forEach((doc) => batch.delete(doc.ref));
                        await batch.commit();
                        console.log(`üóëÔ∏è X√≥a ${oldSnapshot.size} logs c≈©`);
                    }

                    // Format & reverse (m·ªõi nh·∫•t ƒë·∫ßu)
                    const logs = newSnapshot.docs
                        .map((doc) => ({ id: doc.id, ...doc.data() }))
                        .reverse();
                    setLogsData(logs);
                } catch (error) {
                    console.error('L·ªói load logs:', error);
                    setLogsData([]);
                } finally {
                    setLoadingLogs(false);
                }
            };

            const handleRegister = async () => {
                if (!email.trim() || !email.includes('@')) {
                    alert('Vui l√≤ng nh·∫≠p email h·ª£p l·ªá!');
                    return;
                }
                if (!password || password.length < 6) {
                    alert('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
                    return;
                }
                if (password !== confirmPassword) {
                    alert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
                    return;
                }

                setLoading(true);
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    await db.collection('users').doc(user.uid).set({
                        email: user.email,
                        money: 0,
                        fishingRod: 'normal',
                        ownedRods: ['normal'],
                        currentBait: 'normal',
                        ownedBaits: ['normal'],
                        banned: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('ƒêƒÉng k√Ω th√†nh c√¥ng!');
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        alert('Email n√†y ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!');
                    } else {
                        alert('L·ªói ƒëƒÉng k√Ω: ' + error.message);
                    }
                } finally {
                    setLoading(false);
                }
            };

            const handleLogin = async () => {
                if (!email.trim() || !password) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                    return;
                }

                setLoading(true);
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    if (error.code === 'auth/user-not-found') {
                        alert('T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!');
                    } else if (error.code === 'auth/wrong-password') {
                        alert('M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                    } else {
                        alert('L·ªói ƒëƒÉng nh·∫≠p: ' + error.message);
                    }
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = async () => {
                if (window.confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                    await saveGameData();
                    await auth.signOut();
                    setUserId(null);
                    setCurrentUser(null);
                    setMoney(0);
                    setInventory([]);
                    setEmail('');
                    setPassword('');
                    setConfirmPassword('');
                    setLoginMode('login');
                    setGameState('login');
                }
            };

            const getRandomRarity = () => {
                let availableRarities = [...rarities];
                
                if (fishingRod === 'normal') {
                    availableRarities = rarities.filter(r => 
                        !['Legendary', 'Mythic', 'Secret'].includes(r.name)
                    );
                } else if (fishingRod === 'legendary') {
                    availableRarities = rarities.filter(r => 
                        !['Mythic', 'Secret'].includes(r.name)
                    );
                } else if (fishingRod === 'mythic') {
                    availableRarities = rarities.filter(r => 
                        r.name !== 'Secret'
                    );
                }
                
                const totalWeight = availableRarities.reduce((sum, r) => sum + r.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (let rarity of availableRarities) {
                    random -= rarity.weight;
                    if (random <= 0) return rarity;
                }
                return availableRarities[0];
            };

            const calculateWeight = () => {
                let weight = 1.0;
                let increaseChance = 1.0;
                
                while (Math.random() < increaseChance) {
                    weight += 0.1;
                    increaseChance -= 0.001;
                }
                
                return Math.round(weight * 10) / 10;
            };

            const generateMath = (range, rarity) => {
                const difficultyReduction = baitInfo[currentBait].difficulty[rarity] || 0;
                const adjustedRange = Math.max(5, Math.round(range * (1 - difficultyReduction / 100)));
                
                const operations = ['+', '-'];
                const op = operations[Math.floor(Math.random() * operations.length)];
                const num1 = Math.floor(Math.random() * adjustedRange) + 1;
                const num2 = Math.floor(Math.random() * adjustedRange) + 1;
                
                const question = `${num1} ${op} ${num2}`;
                const correctAnswer = op === '+' ? num1 + num2 : num1 - num2;
                
                return { question, correctAnswer };
            };

            const startFishing = () => {
                setGameState('fishing');
                setMessage('');
                
                setTimeout(() => {
                    const rarity = getRandomRarity();
                    const fishName = fishNames[rarity.name][Math.floor(Math.random() * fishNames[rarity.name].length)];
                    const weight = calculateWeight();
                    const math = generateMath(rarity.range, rarity.name);
                    const fishPrice = Math.round(rarity.price * weight);
                    
                    setCurrentFish({
                        rarity: rarity.name,
                        name: fishName,
                        weight: weight,
                        color: rarity.color,
                        math: math,
                        time: rarity.time,
                        price: fishPrice,
                        favourite: false
                    });
                    
                    setTimeLeft(rarity.time);
                    setGameState('question');
                }, 1500);
            };

            useEffect(() => {
                if (gameState === 'question' && timeLeft > 0) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                } else if (gameState === 'question' && timeLeft === 0) {
                    handleTimeout();
                }
            }, [timeLeft, gameState]);

            const handleTimeout = () => {
                setMessage('H·ª•t m·∫•t r·ªìi!');
                setGameState('result');
                setTimeout(() => {
                    setGameState('menu');
                    setAnswer('');
                }, 2000);
            };

            const checkAnswer = async () => {
                const userAnswer = parseInt(answer);

                if (userAnswer === currentFish.math.correctAnswer) {
                    try {
                        // C·∫≠p nh·∫≠t nhi·ªám v·ª• gi·∫£i to√°n
                        await updateQuestProgress('solve', 1);
    
                        // C·∫≠p nh·∫≠t nhi·ªám v·ª• c√¢u c√°
                        await updateQuestProgress('catch', 1, currentFish.rarity);
    
                        // Th√™m c√° v√†o Firestore
                        const docRef = await db.collection('users').doc(userId).collection('inventory').add({
                            name: currentFish.name,
                            rarity: currentFish.rarity,
                            weight: currentFish.weight,
                            price: currentFish.price,
                            color: currentFish.color,
                            favourite: false,
                            caughtAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // Th√™m c√° v√†o state inventory (kh√¥ng x√≥a c√° c≈©)
                        setInventory(prevInventory => [
                            ...prevInventory,
                            {
                                id: docRef.id,
                                name: currentFish.name,
                                rarity: currentFish.rarity,
                                weight: currentFish.weight,
                                price: currentFish.price,
                                color: currentFish.color,
                                favourite: false
                            }
                        ]);

                        // ‚≠ê TH√äM LOG C√ÇU C√Å
                        saveLog('catch_fish', {
                            name: currentFish.name,
                            rarity: currentFish.rarity,
                            weight: currentFish.weight,
                            price: currentFish.price
                        });

                        setMessage(`Ch√∫c m·ª´ng! B·∫°n ƒë√£ c√¢u ƒë∆∞·ª£c ${currentFish.name} n·∫∑ng ${currentFish.weight}kg (${currentFish.rarity})`);
    
                        setGameState('result');
                        setTimeout(() => {
                            setGameState('menu');
                            setAnswer('');
                        }, 3000);
                    } catch (error) {
                        alert('L·ªói khi l∆∞u c√°: ' + error.message);
                    }
                } else {
                    setMessage('H·ª•t m·∫•t r·ªìi!');
                    setGameState('result');
                    setTimeout(() => {
                        setGameState('menu');
                        setAnswer('');
                    }, 2000);
                }
            };

            const toggleFavourite = async (fishId, currentFavourite) => {
                try {
                    await db.collection('users').doc(userId).collection('inventory').doc(fishId).update({
                        favourite: !currentFavourite
                    });

                    const newInventory = inventory.map(fish => 
                        fish.id === fishId ? { ...fish, favourite: !currentFavourite } : fish
                    );
                    setInventory(newInventory);
                } catch (error) {
                    alert('L·ªói khi c·∫≠p nh·∫≠t: ' + error.message);
                }
            };

            const sellFish = async () => {
                const fishToSell = inventory.filter(fish => !fish.favourite);
                const totalMoney = fishToSell.reduce((sum, fish) => sum + fish.price, 0);
    
                try {
                    const batch = db.batch();
                    fishToSell.forEach(fish => {
                        const fishRef = db.collection('users').doc(userId).collection('inventory').doc(fish.id);
                        batch.delete(fishRef);
                    });
                    await batch.commit();

                    const newMoney = money + totalMoney;
                    updateMoneyWithAnimation(newMoney, totalMoney);
                    await db.collection('users').doc(userId).update({ money: newMoney });
                    // ‚≠ê TH√äM LOG B√ÅN C√Å
                    saveLog('sell_fish', { count: fishToSell.length, total: totalMoney }, totalMoney);
        
                    // C·∫≠p nh·∫≠t nhi·ªám v·ª• ki·∫øm ti·ªÅn
                    await updateQuestProgress('earn', totalMoney);

                    setInventory(inventory.filter(fish => fish.favourite));
                    setShowSellConfirm(false);
        
                    if (fishToSell.length > 0) {
                        setMessage(`ƒê√£ b√°n ${fishToSell.length} con c√° v√† nh·∫≠n ƒë∆∞·ª£c ${totalMoney} xu!`);
                        setTimeout(() => setMessage(''), 3000);
                    }
                } catch (error) {
                    alert('L·ªói khi b√°n c√°: ' + error.message);
                }
            };

            const deleteAccount = async () => {
                if (window.confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën X√ìA T√ÄI KHO·∫¢N vƒ©nh vi·ªÖn? D·ªØ li·ªáu s·∫Ω m·∫•t h·∫øt!')) {
                    setLoading(true);
                    try {
                        const user = auth.currentUser;
                        if (user) {
                            // Batch delete inventory
                            const inventoryRef = db.collection('users').doc(user.uid).collection('inventory');
                            const inventorySnapshot = await inventoryRef.get();
                            const batch1 = db.batch();
                            inventorySnapshot.docs.forEach(doc => batch1.delete(doc.ref));
                            await batch1.commit();

                            // Batch delete quests
                            const questsRef = db.collection('users').doc(user.uid).collection('quests');
                            const questsSnapshot = await questsRef.get();
                            const batch2 = db.batch();
                            questsSnapshot.docs.forEach(doc => batch2.delete(doc.ref));
                            await batch2.commit();

                            // Delete user doc
                            await db.collection('users').doc(user.uid).delete();

                            // Delete auth user
                            await user.delete();
                
                            alert('‚úÖ T√†i kho·∫£n ƒë√£ x√≥a th√†nh c√¥ng!');
                        }
                        // Auto sign out & reset
                        await auth.signOut();
                        setGameState('login');
                    } catch (error) {
                        if (error.code === 'auth/requires-recent-login') {
                            alert('‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i ƒë·ªÉ x√≥a (refresh trang v√† login).');
                            await auth.signOut();
                            setGameState('login');
                        } else {
                            alert('L·ªói: ' + error.message);
                        }
                    } finally {
                        setLoading(false);
                    }
                }
            };
            
            const buyRod = async (item) => {
                if (money < item.price) {
                    alert('B·∫°n kh√¥ng ƒë·ªß ti·ªÅn ƒë·ªÉ mua c·∫ßn c√¢u n√†y!');
                    return;
                }

                if (ownedRods.includes(item.unlocks)) {
                    alert('B·∫°n ƒë√£ c√≥ c·∫ßn c√¢u n√†y r·ªìi!');
                    return;
                }

                const newMoney = money - item.price;
                const newOwnedRods = [...ownedRods, item.unlocks];

                updateMoneyWithAnimation(newMoney, -item.price);
                setOwnedRods(newOwnedRods);
                
                await db.collection('users').doc(userId).update({
                    money: newMoney,
                    ownedRods: newOwnedRods
                });

                // ‚≠ê TH√äM LOG MUA C·∫¶N
                saveLog('buy_rod', { rod: item.name, price: item.price }, -item.price);

                setMessage(`‚úÖ ƒê√£ mua ${item.name} th√†nh c√¥ng! V√†o Balo ƒë·ªÉ trang b·ªã.`);
                setTimeout(() => setMessage(''), 3000);
            };

            const buyBait = async (baitType) => {
                const bait = baitInfo[baitType];
                
                if (money < bait.price) {
                    alert('B·∫°n kh√¥ng ƒë·ªß ti·ªÅn ƒë·ªÉ mua m·ªìi n√†y!');
                    return;
                }

                if (ownedBaits.includes(baitType)) {
                    alert('B·∫°n ƒë√£ c√≥ m·ªìi n√†y r·ªìi!');
                    return;
                }

                const newMoney = money - bait.price;
                const newOwnedBaits = [...ownedBaits, baitType];

                updateMoneyWithAnimation(newMoney, -bait.price);
                setOwnedBaits(newOwnedBaits);
                
                await db.collection('users').doc(userId).update({
                    money: newMoney,
                    ownedBaits: newOwnedBaits
                });

                // ‚≠ê TH√äM LOG MUA M·ªíI
                saveLog('buy_bait', { bait: bait.name, price: bait.price }, -bait.price);

                setMessage(`‚úÖ ƒê√£ mua ${bait.name} th√†nh c√¥ng! V√†o Balo ƒë·ªÉ trang b·ªã.`);
                setTimeout(() => setMessage(''), 3000);
            };

            const equipRod = async (rodType) => {
                setFishingRod(rodType);
                await db.collection('users').doc(userId).update({ fishingRod: rodType });
                setMessage(`‚úÖ ƒê√£ trang b·ªã ${getRodNameByType(rodType)}!`);
                setTimeout(() => setMessage(''), 2000);
            };

            const equipBait = async (baitType) => {
                setCurrentBait(baitType);
                await db.collection('users').doc(userId).update({ currentBait: baitType });
                setMessage(`‚úÖ ƒê√£ trang b·ªã ${baitInfo[baitType].name}!`);
                setTimeout(() => setMessage(''), 2000);
            };

            const getRodName = () => {
                return getRodNameByType(fishingRod);
            };

            const getRodNameByType = (type) => {
                switch(type) {
                    case 'legendary': return 'New Rank Fish!';
                    case 'mythic': return 'Mythical Fishing Rod';
                    case 'secret': return 'Mysterious Fishing Rod';
                    default: return 'Normal Rod';
                }
            };

            const getRodDescription = (type) => {
                switch(type) {
                    case 'legendary': return 'C√¢u ƒë∆∞·ª£c c√° ƒë·∫øn Legendary';
                    case 'mythic': return 'C√¢u ƒë∆∞·ª£c c√° ƒë·∫øn Mythic';
                    case 'secret': return 'C√¢u ƒë∆∞·ª£c t·∫•t c·∫£ lo·∫°i c√°';
                    default: return 'C·∫ßn c√¢u c∆° b·∫£n';
                }
            };

            const getRodColor = (type) => {
                switch(type) {
                    case 'legendary': return '#22C55E';
                    case 'mythic': return '#EF4444';
                    case 'secret': return '#1F2937';
                    default: return '#9CA3AF';
                }
            };

            // Admin Panel UI
            if (showAdminPanel) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 p-8">
                        {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{
                                        animation: 'slideUp 2s ease-out forwards'
                                    }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
                        
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 className="text-3xl font-bold text-gray-800">‚öôÔ∏è Admin Command Panel</h2>
                                        <p className="text-sm text-gray-600 mt-1">Quy·ªÅn Admin: {currentUser}</p>
                                    </div>
                                    <button
                                        onClick={() => setShowAdminPanel(false)}
                                        className="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                                    >
                                        Quay l·∫°i
                                    </button>
                                </div>

                                <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                                    <h3 className="font-bold mb-2">üìã Danh s√°ch l·ªánh:</h3>
                                    <div className="text-sm text-gray-700 space-y-1">
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/givefish &lt;t√™n c√°&gt; &lt;email&gt;</code> - T·∫∑ng c√° cho ng∆∞·ªùi ch∆°i</p>
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/givemoney &lt;s·ªë xu&gt; &lt;email&gt;</code> - T·∫∑ng xu cho ng∆∞·ªùi ch∆°i</p>
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/giverod &lt;legendary|mythic|secret&gt; &lt;email&gt;</code> - T·∫∑ng c·∫ßn c√¢u</p>
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/help</code> - Hi·ªÉn th·ªã tr·ª£ gi√∫p</p>
                                    </div>
                                </div>

                                <div className="mb-4">
                                    <input
                                        type="text"
                                        value={adminCommand}
                                        onChange={(e) => setAdminCommand(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && executeAdminCommand()}
                                        placeholder="Nh·∫≠p l·ªánh... (v√≠ d·ª•: /givefish C√° R·ªìng abc@gmail.com)"
                                        className="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"
                                    />
                                </div>

                                <button
                                    onClick={executeAdminCommand}
                                    className="w-full py-3 bg-blue-600 text-white text-lg font-bold rounded-lg hover:bg-blue-700 transition mb-4"
                                >
                                    ‚ñ∂Ô∏è Th·ª±c thi l·ªánh
                                </button>

                                {adminOutput && (
                                    <div className="p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-sm whitespace-pre-wrap">
                                        {adminOutput}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // ‚≠ê PANEL LOGS (CH·ªà ADMIN)
            if (showLogs) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 p-8">
                        {/* Money bar gi·ªëng admin panel */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{ animation: 'slideUp 2s ease-out forwards' }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
            
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 className="text-3xl font-bold text-gray-800">üìã Activity Logs (24h qua)</h2>
                                        <p className="text-sm text-gray-600 mt-1">T·ª± ƒë·ªông x√≥a logs c≈© h∆°n 24h</p>
                                    </div>
                                    <div className="space-x-2">
                                        <button
                                            onClick={loadLogs}
                                            disabled={loadingLogs}
                                            className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:bg-gray-400 transition"
                                        >
                                            {loadingLogs ? '‚è≥' : 'üîÑ'} Refresh
                                        </button>
                                        <button
                                            onClick={() => setShowLogs(false)}
                                            className="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                                        >
                                            Quay l·∫°i
                                        </button>
                                    </div>
                                </div>

                                {loadingLogs ? (
                                    <div className="flex justify-center py-12">
                                        <div className="text-xl text-gray-500">‚è≥ ƒêang t·∫£i logs...</div>
                                    </div>
                                ) : logsData.length === 0 ? (
                                    <div className="text-center py-12 text-gray-500 text-xl">
                                        üì≠ Ch∆∞a c√≥ ho·∫°t ƒë·ªông trong 24h qua
                                    </div>
                                ) : (
                                    <div className="space-y-3 max-h-[70vh] overflow-y-auto p-4 bg-gray-50 rounded-xl">
                                        {logsData.map((log) => (
                                            <div key={log.id} className="p-4 bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition">
                                                <div className="flex justify-between items-start mb-2">
                                                    <strong className="text-lg text-gray-800">{log.userEmail}</strong>
                                                    <span className="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                                        {log.timestamp?.toDate ? log.timestamp.toDate().toLocaleString('vi-VN') : 'N/A'}
                                                    </span>
                                                </div>
                                                <p className="text-gray-700 font-medium">{formatLogMessage(log)}</p>
                                                {log.amount !== 0 && log.amount !== undefined && (
                                                    <span className={`ml-2 px-3 py-1 rounded-full text-sm font-bold ${
                                                        log.amount > 0 
                                                            ? 'bg-green-100 text-green-800' 
                                                            : 'bg-red-100 text-red-800'
                                                    }`}>
                                                        {log.amount > 0 ? `+${formatMoney(Math.abs(log.amount))}` : formatMoney(Math.abs(log.amount))} xu
                                                    </span>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (configError) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-red-600 to-red-800">
                        <div className="bg-white rounded-xl shadow-2xl p-12 max-w-2xl w-full mx-4">
                            <h1 className="text-4xl font-bold text-center mb-6 text-red-600">‚ö†Ô∏è C·∫•u h√¨nh Firebase</h1>
                            <div className="bg-red-50 border-2 border-red-300 rounded-lg p-6 mb-6">
                                <p className="text-lg text-red-800 mb-4">
                                    B·∫°n c·∫ßn c·∫•u h√¨nh Firebase tr∆∞·ªõc khi s·ª≠ d·ª•ng game!
                                </p>
                                <ol className="text-sm text-red-700 space-y-2 ml-4">
                                    <li><strong>1.</strong> Truy c·∫≠p <a href="https://console.firebase.google.com" target="_blank" className="text-blue-600 underline">Firebase Console</a></li>
                                    <li><strong>2.</strong> T·∫°o project m·ªõi ho·∫∑c ch·ªçn project c√≥ s·∫µn</li>
                                    <li><strong>3.</strong> V√†o <strong>Project Settings</strong> ‚Üí <strong>Your apps</strong> ‚Üí Ch·ªçn Web app</li>
                                    <li><strong>4.</strong> Copy Firebase config v√† thay th·∫ø v√†o code</li>
                                    <li><strong>5.</strong> B·∫≠t <strong>Authentication</strong> (Email/Password)</li>
                                    <li><strong>6.</strong> B·∫≠t <strong>Firestore Database</strong></li>
                                </ol>
                            </div>
                        </div>
                    </div>
                );
            }

            // Admin Panel UI
            if (showAdminPanel) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 p-8">
                        {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{
                                        animation: 'slideUp 2s ease-out forwards'
                                    }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
            
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 className="text-3xl font-bold text-gray-800">‚öôÔ∏è Admin Command Panel</h2>
                                        <p className="text-sm text-gray-600 mt-1">Quy·ªÅn Admin: {currentUser}</p>
                                    </div>
                                    <button
                                        onClick={() => setShowAdminPanel(false)}
                                        className="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                                    >
                                        Quay l·∫°i
                                    </button>
                                </div>

                                <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                                    <h3 className="font-bold mb-2">üìã Danh s√°ch l·ªánh:</h3>
                                    <div className="text-sm text-gray-700 space-y-1">
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/givefish &lt;t√™n c√°&gt; &lt;email&gt;</code> - T·∫∑ng c√° cho ng∆∞·ªùi ch∆°i</p>
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/givemoney &lt;s·ªë xu&gt; &lt;email&gt;</code> - T·∫∑ng xu cho ng∆∞·ªùi ch∆°i</p>
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/giverod &lt;legendary|mythic|secret&gt; &lt;email&gt;</code> - T·∫∑ng c·∫ßn c√¢u</p>
                                        <p><code className="bg-gray-200 px-2 py-1 rounded">/help</code> - Hi·ªÉn th·ªã tr·ª£ gi√∫p</p>
                                    </div>
                                </div>

                                <div className="mb-4">
                                    <input
                                        type="text"
                                        value={adminCommand}
                                        onChange={(e) => setAdminCommand(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && executeAdminCommand()}
                                        placeholder="Nh·∫≠p l·ªánh... (v√≠ d·ª•: /givefish C√° R·ªìng test@gmail.com)"
                                        className="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"
                                    />
                                </div>

                                <button
                                    onClick={executeAdminCommand}
                                    className="w-full py-3 bg-blue-600 text-white text-lg font-bold rounded-lg hover:bg-blue-700 transition mb-4"
                                >
                                    ‚ñ∂Ô∏è Th·ª±c thi l·ªánh
                                </button>

                                {adminOutput && (
                                    <div className="p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-sm whitespace-pre-wrap">
                                        {adminOutput}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'banned') {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-red-600 to-red-800 p-8">
                        <div className="bg-white rounded-xl shadow-2xl p-12 max-w-md w-full mx-4">
                            <h1 className="text-4xl font-bold text-center mb-6 text-red-600">‚ö†Ô∏è T√†i Kho·∫£n B·ªã Ban</h1>
                            <p className="text-lg text-center text-gray-800 mb-8">
                                B·∫°n ƒë√£ b·ªã ban. Vui l√≤ng li√™n h·ªá Discord <a href="https://discord.gg/8fHj47BH" target="_blank" className="text-blue-600 underline font-bold">https://discord.gg/8fHj47BH</a> ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ ho·∫∑c x√≥a t√†i kho·∫£n qua n√∫t d∆∞·ªõi.
                            </p>
                            <div className="flex gap-4">
                                <button
                                    onClick={deleteAccount}
                                    className="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-bold text-lg"
                                >
                                    üóëÔ∏è X√≥a t√†i kho·∫£n
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition"
                                >
                                    ƒêƒÉng xu·∫•t
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'login') {
                return (
                    <div
                      className="min-h-screen flex items-center justify-center bg-cover bg-center p-8"
                      style={{ backgroundImage: "url('background.jpg')" }}
                    >
                        <div className="bg-white rounded-xl shadow-2xl p-12 max-w-md w-full mx-4">
                            <h1 className="text-4xl font-bold text-center mb-8 text-gray-800">üé£ Fishing With The Math</h1>
                            <p className="text-center text-sm text-green-600 font-semibold mb-4">‚úÖ S·ª≠ d·ª•ng Firebase</p>
                            
                            {loading ? (
                                <div className="text-center text-gray-600 text-lg py-8">ƒêang x·ª≠ l√Ω...</div>
                            ) : (
                                <>
                                    <div className="flex gap-2 mb-6">
                                        <button
                                            onClick={() => setLoginMode('login')}
                                            className={`flex-1 py-3 rounded-lg font-bold transition ${
                                                loginMode === 'login' 
                                                    ? 'bg-blue-600 text-white' 
                                                    : 'bg-gray-300 text-gray-700'
                                            }`}
                                        >
                                            ƒêƒÉng nh·∫≠p
                                        </button>
                                        <button
                                            onClick={() => setLoginMode('register')}
                                            className={`flex-1 py-3 rounded-lg font-bold transition ${
                                                loginMode === 'register' 
                                                    ? 'bg-blue-600 text-white' 
                                                    : 'bg-gray-300 text-gray-700'
                                            }`}
                                        >
                                            ƒêƒÉng k√Ω
                                        </button>
                                    </div>

                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        placeholder="Email"
                                        className="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-purple-600"
                                    />
                                    
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        placeholder="M·∫≠t kh·∫©u"
                                        className="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-purple-600"
                                    />

                                    {loginMode === 'register' && (
                                        <input
                                            type="password"
                                            value={confirmPassword}
                                            onChange={(e) => setConfirmPassword(e.target.value)}
                                            placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u"
                                            className="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-purple-600"
                                        />
                                    )}

                                    <button
                                        onClick={loginMode === 'login' ? handleLogin : handleRegister}
                                        className="w-full py-3 bg-blue-600 text-white text-xl font-bold rounded-lg hover:bg-blue-700 transition mb-4"
                                    >
                                        {loginMode === 'login' ? 'üéÆ ƒêƒÉng nh·∫≠p' : 'üìù ƒêƒÉng k√Ω'}
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                );
            }

            if (showInventory) {
                return (
                    <div
                      className="min-h-screen bg-cover bg-center p-8"
                      style={{ backgroundImage: "url('inbackpack.png')" }}
                    >
                        {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{
                                        animation: 'slideUp 2s ease-out forwards'
                                    }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
                        
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-3xl font-bold text-gray-800">üéí Balo</h2>
                                    <button
                                        onClick={() => {
                                            setShowInventory(false);
                                            setInventoryTab('fish');
                                        }}
                                        className="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
                                    >
                                        Quay l·∫°i
                                    </button>
                                </div>

                                <div className="flex gap-2 mb-6">
                                    <button
                                        onClick={() => setInventoryTab('fish')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            inventoryTab === 'fish' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        üêü C√° ({inventory.length})
                                    </button>
                                    <button
                                        onClick={() => setInventoryTab('rods')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            inventoryTab === 'rods' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        üé£ C·∫ßn c√¢u ({ownedRods.length})
                                    </button>
                                    <button
                                        onClick={() => setInventoryTab('baits')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            inventoryTab === 'baits' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        ü™± M·ªìi c√¢u ({ownedBaits.length})
                                    </button>
                                </div>
                                
                                {inventoryTab === 'fish' ? (
                                    <div>
                                        {inventory.length === 0 ? (
                                            <p className="text-center text-gray-500 text-xl py-12">Ch∆∞a c√≥ c√° n√†o trong balo!</p>
                                        ) : (
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {inventory.map((fish) => (
                                                    <div
                                                        key={fish.id}
                                                        className="border-4 rounded-lg p-4 relative"
                                                        style={{ borderColor: fish.color }}
                                                    >
                                                        <button
                                                            onClick={() => toggleFavourite(fish.id, fish.favourite)}
                                                            className="absolute top-2 right-2 text-3xl hover:scale-110 transition"
                                                        >
                                                            {fish.favourite ? '‚≠ê' : '‚òÜ'}
                                                        </button>
                                                        
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <FishIcon size={32} color={fish.color} />
                                                            <h3 className="text-xl font-bold" style={{ color: fish.color }}>
                                                                {fish.name}
                                                            </h3>
                                                        </div>
                                                        <div className="space-y-1 text-gray-700">
                                                            <p><strong>ƒê·ªô hi·∫øm:</strong> {fish.rarity}</p>
                                                            <p><strong>C√¢n n·∫∑ng:</strong> {fish.weight} kg</p>
                                                            <p><strong>Gi√° tr·ªã:</strong> {fish.price} xu</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ) : inventoryTab === 'rods' ? (
                                    <div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {ownedRods.map((rodType, index) => (
                                                <div
                                                    key={index}
                                                    className="border-4 rounded-lg p-6 relative"
                                                    style={{ borderColor: getRodColor(rodType) }}
                                                >
                                                    {fishingRod === rodType && (
                                                        <div className="absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                            ‚úì ƒêang d√πng
                                                        </div>
                                                    )}
                                                    
                                                    <div className="text-center mb-4">
                                                        <div className="text-5xl mb-2">üé£</div>
                                                        <h3 className="text-xl font-bold mb-2" style={{ color: getRodColor(rodType) }}>
                                                            {getRodNameByType(rodType)}
                                                        </h3>
                                                        <p className="text-gray-600 text-sm mb-4">
                                                            {getRodDescription(rodType)}
                                                        </p>
                                                    </div>
                                                    
                                                    {fishingRod !== rodType && (
                                                        <button
                                                            onClick={() => equipRod(rodType)}
                                                            className="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                                                        >
                                                            Trang b·ªã
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            {ownedBaits.map((baitType, index) => {
                                                const bait = baitInfo[baitType];
                                                return (
                                                    <div
                                                        key={index}
                                                        className="border-4 rounded-lg p-6 relative"
                                                        style={{ borderColor: bait.color }}
                                                    >
                                                        {currentBait === baitType && (
                                                            <div className="absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                                ‚úì ƒêang d√πng
                                                            </div>
                                                        )}
                                                        
                                                        <div className="text-center mb-4">
                                                            <div className="text-5xl mb-2">{bait.icon}</div>
                                                            <h3 className="text-xl font-bold mb-2" style={{ color: bait.color }}>
                                                                {bait.name}
                                                            </h3>
                                                            <p className="text-gray-600 text-sm mb-4">
                                                                {bait.description}
                                                            </p>
                                                        </div>
                                                        
                                                        {currentBait !== baitType && (
                                                            <button
                                                                onClick={() => equipBait(baitType)}
                                                                className="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                                                            >
                                                                Trang b·ªã
                                                            </button>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (showShop) {
                return (
                    <div
                      className="min-h-screen bg-cover bg-center p-8"
                      style={{ backgroundImage: "url('inshop.png')" }}
                    >
                        {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{
                                        animation: 'slideUp 2s ease-out forwards'
                                    }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
                        
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-3xl font-bold text-gray-800">ü™ù C·ª≠a H√†ng</h2>
                                    <button
                                        onClick={() => setShowShop(false)}
                                        className="px-6 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition"
                                    >
                                        Quay l·∫°i
                                    </button>
                                </div>

                                <div className="flex gap-2 mb-6">
                                    <button
                                        onClick={() => setShopTab('rods')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            shopTab === 'rods' 
                                                ? 'bg-purple-600 text-white' 
                                                : 'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        üé£ C·∫ßn C√¢u
                                    </button>
                                    <button
                                        onClick={() => setShopTab('baits')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            shopTab === 'baits' 
                                                ? 'bg-purple-600 text-white' 
                                                : 'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        ü™± M·ªìi C√¢u
                                    </button>
                                </div>

                                <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                                    <p className="text-lg font-semibold text-blue-900">
                                        üé£ C·∫ßn c√¢u: <span className="text-blue-600">{getRodName()}</span>
                                        <span className="mx-2">|</span>
                                        ü™± M·ªìi: <span className="text-green-600">{baitInfo[currentBait].name}</span>
                                    </p>
                                </div>
                                
                                {shopTab === 'rods' ? (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {shopItems.map((item) => {
                                            const isOwned = ownedRods.includes(item.unlocks);
                                            
                                            return (
                                                <div
                                                    key={item.id}
                                                    className="border-4 border-gray-300 rounded-lg p-6 relative bg-gradient-to-b from-white to-gray-50"
                                                >
                                                    {isOwned && (
                                                        <div className="absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                            ‚úì ƒê√£ mua
                                                        </div>
                                                    )}
                                                    
                                                    <div className="text-center mb-4">
                                                        <div className="text-5xl mb-3">üé£</div>
                                                    </div>
                                                    
                                                    <h3 className="text-2xl font-bold mb-2 text-gray-800">
                                                        {item.name}
                                                    </h3>
                                                    <p className="text-gray-600 mb-4 min-h-12">
                                                        {item.description}
                                                    </p>
                                                    <p className="text-3xl font-bold text-yellow-600 mb-4">
                                                        üí∞ {item.price} xu
                                                    </p>
                                                    <button
                                                        onClick={() => buyRod(item)}
                                                        disabled={isOwned || money < item.price}
                                                        className={`w-full py-3 text-white text-lg font-bold rounded-lg transition ${item.color} disabled:bg-gray-400 disabled:cursor-not-allowed`}
                                                    >
                                                        {isOwned ? 'ƒê√£ s·ªü h·ªØu' : money < item.price ? 'Kh√¥ng ƒë·ªß ti·ªÅn' : 'Mua ngay'}
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {Object.entries(baitInfo).filter(([key]) => key !== 'normal').map(([baitType, bait]) => {
                                            const isOwned = ownedBaits.includes(baitType);
                                            
                                            return (
                                                <div
                                                    key={baitType}
                                                    className="border-4 rounded-lg p-6 relative bg-gradient-to-b from-white to-gray-50"
                                                    style={{ borderColor: bait.color }}
                                                >
                                                    {isOwned && (
                                                        <div className="absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                            ‚úì ƒê√£ mua
                                                        </div>
                                                    )}
                                                    
                                                    <div className="text-center mb-4">
                                                        <div className="text-6xl mb-3">{bait.icon}</div>
                                                        <h3 className="text-2xl font-bold mb-2" style={{ color: bait.color }}>
                                                            {bait.name}
                                                        </h3>
                                                        <p className="text-gray-600 mb-4 min-h-12">
                                                            {bait.description}
                                                        </p>
                                                    </div>
                                                    
                                                    <div className="mb-4 text-sm text-gray-700">
                                                        <p className="font-bold mb-2">Gi·∫£m ƒë·ªô kh√≥:</p>
                                                        <div className="space-y-1">
                                                            <p>Common: {bait.difficulty.Common}%</p>
                                                            <p>Uncommon: {bait.difficulty.Uncommon}%</p>
                                                            <p>Rare: {bait.difficulty.Rare}%</p>
                                                            <p>Legendary: {bait.difficulty.Legendary}%</p>
                                                            <p>Mythic: {bait.difficulty.Mythic}%</p>
                                                            <p>Secret: {bait.difficulty.Secret}%</p>
                                                        </div>
                                                    </div>

                                                    <p className="text-3xl font-bold text-yellow-600 mb-4">
                                                        üí∞ {bait.price} xu
                                                    </p>
                                                    <button
                                                        onClick={() => buyBait(baitType)}
                                                        disabled={isOwned || money < bait.price}
                                                        className="w-full py-3 text-white text-lg font-bold rounded-lg transition bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed"
                                                    >
                                                        {isOwned ? 'ƒê√£ s·ªü h·ªØu' : money < bait.price ? 'Kh√¥ng ƒë·ªß ti·ªÅn' : 'Mua ngay'}
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (showLeaderboard) {
                const sortedData = leaderboardTab === 'fish' 
                    ? [...leaderboardData].sort((a, b) => b.fishCount - a.fishCount)
                    : [...leaderboardData].sort((a, b) => b.money - a.money);

                return (
                    <div
                      className="min-h-screen bg-cover bg-center p-8"
                      style={{ backgroundImage: "url('inleaderboard.jpg')" }}
                    >
                        {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{
                                        animation: 'slideUp 2s ease-out forwards'
                                    }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
            
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-3xl font-bold text-gray-800">üèÜ B·∫£ng X·∫øp H·∫°ng</h2>
                                    <button
                                        onClick={() => setShowLeaderboard(false)}
                                        className="px-6 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition"
                                    >
                                        Quay l·∫°i
                                    </button>
                                </div>

                                <div className="flex gap-2 mb-6">
                                    <button
                                        onClick={() => setLeaderboardTab('fish')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            leaderboardTab === 'fish' 
                                                ? 'bg-blue-600 text-white' 
                                    :             'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        üêü S·ªë C√° C√¢u ƒê∆∞·ª£c
                                    </button>
                                    <button
                                        onClick={() => setLeaderboardTab('money')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition ${
                                            leaderboardTab === 'money' 
                                                ? 'bg-yellow-600 text-white' 
                                                : 'bg-gray-300 text-gray-700'
                                        }`}
                                    >
                                        üí∞ S·ªë Ti·ªÅn
                                    </button>
                                </div>

                                <button
                                    onClick={loadLeaderboard}
                                    disabled={loadingLeaderboard}
                                    className="w-full mb-4 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:bg-gray-400"
                                >
                                    {loadingLeaderboard ? '‚è≥ ƒêang t·∫£i...' : 'üîÑ L√†m m·ªõi'}
                                </button>

                                {loadingLeaderboard ? (
                                    <div className="text-center text-gray-500 text-xl py-12">
                                        ƒêang t·∫£i b·∫£ng x·∫øp h·∫°ng...
                                    </div>
                                ) : sortedData.length === 0 ? (
                                    <div className="text-center text-gray-500 text-xl py-12">
                                        Ch∆∞a c√≥ d·ªØ li·ªáu
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {sortedData.map((player, index) => {
                                            const isCurrentUser = player.id === userId;
                                            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                                
                                            return (
                                                <div
                                                    key={player.id}
                                                    className={`flex items-center justify-between p-4 rounded-lg border-2 ${
                                                        isCurrentUser 
                                                            ? 'bg-blue-50 border-blue-500' 
                                                            : 'bg-gray-50 border-gray-200'
                                                    }`}
                                                >
                                                    <div className="flex items-center gap-4">
                                                        <span className="text-3xl font-bold w-12 text-center">
                                                            {medal}
                                                        </span>
                                                        <div>
                                                            <p className="font-bold text-lg text-gray-800">
                                                                {player.email}
                                                                {isCurrentUser && (
                                                                    <span className="ml-2 text-sm bg-blue-500 text-white px-2 py-1 rounded">
                                                                        B·∫°n
                                                                    </span>
                                                                )}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        {leaderboardTab === 'fish' ? (
                                                            <p className="text-2xl font-bold text-blue-600">
                                                                üêü {player.fishCount}
                                                            </p>
                                                        ) : (
                                                            <p className="text-2xl font-bold text-yellow-600">
                                                                üí∞ {player.money} xu
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (showQuests) {
                const completedCount = dailyQuests.filter(q => q.completed).length;
                const claimedCount = dailyQuests.filter(q => q.claimed).length;
    
                return (
                    <div
                      className="min-h-screen bg-cover bg-center p-8"
                      style={{ backgroundImage: "url('inquest.png')" }}
                    >
                        {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                        <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-2xl font-bold text-gray-800">
                                üí∞ {formatMoney(Math.floor(displayMoney))} xu
                            </p>
                            {showMoneyChange && (
                                <div 
                                    className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                        moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                    }`}
                                    style={{
                                        animation: 'slideUp 2s ease-out forwards'
                                    }}
                                >
                                    {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                                </div>
                            )}
                        </div>
            
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-2xl p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 className="text-3xl font-bold text-gray-800">üìã Nhi·ªám V·ª• H·∫±ng Ng√†y</h2>
                                        <p className="text-sm text-gray-600 mt-1">
                                            Ho√†n th√†nh: {completedCount}/{dailyQuests.length} | 
                                            ƒê√£ nh·∫≠n th∆∞·ªüng: {claimedCount}/{dailyQuests.length}
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => setShowQuests(false)}
                                        className="px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition"
                                    >
                                        Quay l·∫°i
                                    </button>
                                </div>

                                {dailyQuests.length === 0 ? (
                                    <div className="text-center text-gray-500 text-xl py-12">
                                        ƒêang t·∫£i nhi·ªám v·ª•...
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {dailyQuests.map((quest) => {
                                            const progressPercent = Math.min((quest.progress / quest.target) * 100, 100);
                                
                                            return (
                                                <div
                                                    key={quest.id}
                                                    className={`border-2 rounded-lg p-6 transition ${
                                                        quest.completed 
                                                            ? 'bg-green-50 border-green-500' 
                                                            : 'bg-gray-50 border-gray-300'
                                                    }`}
                                                >
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-4xl">{quest.icon}</span>
                                                            <div>
                                                                <h3 className="text-xl font-bold text-gray-800">
                                                                    {quest.title}
                                                                </h3>
                                                                <p className="text-gray-600">
                                                                    {quest.description.replace('{target}', quest.target)}
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className="text-2xl font-bold text-yellow-600">
                                                                +{quest.reward} xu
                                                            </p>
                                                        </div>
                                                    </div>
                                        
                                                    <div className="mb-3">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="text-sm text-gray-600">
                                                                Ti·∫øn ƒë·ªô: {quest.progress}/{quest.target}
                                                            </span>
                                                            <span className="text-sm font-semibold text-gray-700">
                                                                {progressPercent.toFixed(0)}%
                                                            </span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                                            <div
                                                                className={`h-full rounded-full transition-all duration-500 ${
                                                                    quest.completed ? 'bg-green-500' : 'bg-blue-500'
                                                                }`}
                                                                style={{ width: `${progressPercent}%` }}
                                                            />
                                                        </div>
                                                    </div>
                                        
                                                    {quest.completed && !quest.claimed && (
                                                        <button
                                                            onClick={() => claimQuestReward(quest.id)}
                                                            className="w-full py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition animate-pulse"
                                                        >
                                                            üéÅ Nh·∫≠n th∆∞·ªüng
                                                        </button>
                                                    )}
                                        
                                                    {quest.claimed && (
                                                        <div className="w-full py-3 bg-gray-400 text-white font-bold rounded-lg text-center">
                                                            ‚úÖ ƒê√£ nh·∫≠n th∆∞·ªüng
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                    
                                {lastQuestReset && (
                                    <div className="mt-6 p-4 bg-blue-50 rounded-lg text-center">
                                        <p className="text-sm text-gray-600">
                                            ‚è∞ Nhi·ªám v·ª• s·∫Ω ƒë∆∞·ª£c l√†m m·ªõi v√†o 00:00 m·ªói ng√†y
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div
                  className={`min-h-screen flex items-center justify-center transition-all duration-500 bg-cover bg-center ${
                    gameState === 'fishing' || gameState === 'question'
                      ? ''
                      : ''
                  }`}
                  style={
                    gameState === 'fishing' || gameState === 'question'
                      ? { backgroundImage: "url('infishingtime.jpg')" }
                      : { backgroundImage: "url('background.jpg')" }
                  }
                >
                    <div className="fixed top-4 left-4 bg-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3">
                        <span className="text-lg">üë§ <strong>{currentUser}</strong></span>
                        {isAdmin && (
                            <span className="bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">ADMIN</span>
                        )}
                        <button
                            onClick={handleLogout}
                            className="bg-red-500 text-white px-4 py-1 rounded-md text-sm hover:bg-red-600 transition"
                        >
                            ƒêƒÉng xu·∫•t
                        </button>
                    </div>

                    {/* Thay th·∫ø ph·∫ßn hi·ªÉn th·ªã money c≈© */}
                    <div className="fixed top-4 right-4 bg-yellow-400 px-6 py-3 rounded-lg shadow-lg z-50">
                        <p className="text-2xl font-bold text-gray-800">
                            üí∞ {formatMoney(Math.floor(displayMoney))} xu
                        </p>
                        {showMoneyChange && (
                            <div 
                                className={`absolute -bottom-8 right-0 text-xl font-bold animate-bounce ${
                                    moneyChange > 0 ? 'text-green-500' : 'text-red-500'
                                }`}
                                style={{
                                    animation: 'slideUp 2s ease-out forwards'
                                }}
                            >
                                {moneyChange > 0 ? '+' : ''}{formatMoney(moneyChange)}
                            </div>
                        )}
                    </div>
                    
                    {message && gameState === 'menu' && (
                        <div className="fixed top-20 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
                            <p className="text-xl font-bold">{message}</p>
                        </div>
                    )}
                    
                    {showSellConfirm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-8 max-w-md mx-4">
                                <h3 className="text-2xl font-bold mb-4 text-gray-800">X√°c nh·∫≠n b√°n c√°</h3>
                                <p className="text-lg mb-6 text-gray-600">
                                    B·∫°n c√≥ {inventory.filter(f => !f.favourite).length} con c√° c√≥ th·ªÉ b√°n
                                    <br />
                                    <span className="text-sm text-gray-500">(C√° ƒë∆∞·ª£c ƒë√°nh d·∫•u ‚≠ê s·∫Ω kh√¥ng b·ªã b√°n)</span>
                                </p>
                                <div className="flex gap-4">
                                    <button
                                        onClick={sellFish}
                                        className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                                    >
                                        ƒê·ªìng √Ω
                                    </button>
                                    <button
                                        onClick={() => setShowSellConfirm(false)}
                                        className="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
                                    >
                                        H·ªßy
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <div className="text-center">
                        {gameState === 'menu' && (
                            <div className="space-y-6">
                                <h1 className="text-5xl font-bold text-white mb-8 drop-shadow-lg">
                                    üé£ Fishing With The Math üé£
                                </h1>
                                <button
                                    onClick={startFishing}
                                    className="px-12 py-4 bg-blue-600 text-white text-2xl rounded-lg hover:bg-blue-700 transform hover:scale-105 transition shadow-lg"
                                >
                                    B·∫Øt ƒë·∫ßu c√¢u c√°
                                </button>
                                
                                <div className="flex gap-4 justify-center mt-6">
                                    <button
                                        onClick={() => setShowInventory(true)}
                                        className="px-8 py-3 bg-green-600 text-white text-xl rounded-lg hover:bg-green-700 transform hover:scale-105 transition shadow-lg flex items-center gap-2"
                                    >
                                        <PackageIcon size={24} />
                                        Balo ({inventory.length})
                                    </button>

                                    <button
                                        onClick={() => setShowQuests(true)}
                                        className="px-8 py-3 bg-indigo-600 text-white text-xl rounded-lg hover:bg-indigo-700 transform hover:scale-105 transition shadow-lg relative"
                                    >
                                        üìã Nhi·ªám v·ª•
                                        {dailyQuests.filter(q => q.completed && !q.claimed).length > 0 && (
                                            <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold animate-bounce">
                                                {dailyQuests.filter(q => q.completed && !q.claimed).length}
                                            </span>
                                        )}
                                    </button>

                                    {isAdmin && (
                                        <button
                                            onClick={() => setShowAdminPanel(true)}
                                            className="px-8 py-3 bg-gradient-to-r from-red-600 to-pink-600 text-white text-xl rounded-lg hover:from-red-700 hover:to-pink-700 transform hover:scale-105 transition shadow-lg border-2 border-yellow-400 animate-pulse"
                                        >
                                            ‚öôÔ∏è Admin Command
                                        </button>
                                    )}

                                    {isAdmin && (
                                        <button
                                            onClick={() => { setShowLogs(true); loadLogs(); }}
                                            className="px-8 py-3 bg-indigo-600 text-white text-xl rounded-lg hover:bg-indigo-700 transform hover:scale-105 transition shadow-lg"
                                        >
                                            üìã Logs
                                        </button>
                                    )}

                                    <button
                                        onClick={() => {
                                            setShowLeaderboard(true);
                                            loadLeaderboard();
                                        }}
                                        className="px-8 py-3 bg-yellow-600 text-white text-xl rounded-lg hover:bg-yellow-700 transform hover:scale-105 transition shadow-lg"
                                    >
                                        üèÜ B·∫£ng x·∫øp h·∫°ng
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowShop(true)}
                                        className="px-8 py-3 bg-purple-600 text-white text-xl rounded-lg hover:bg-purple-700 transform hover:scale-105 transition shadow-lg"
                                    >
                                        ü™ù C·ª≠a h√†ng
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowSellConfirm(true)}
                                        disabled={inventory.filter(f => !f.favourite).length === 0}
                                        className="px-8 py-3 bg-orange-600 text-white text-xl rounded-lg hover:bg-orange-700 transform hover:scale-105 transition shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed disabled:hover:scale-100"
                                    >
                                        üíµ B√°n c√°
                                    </button>
                                </div>

                                <div className="mt-6 p-4 bg-white bg-opacity-50 rounded-lg space-y-2">
                                    <p className="text-lg font-semibold text-gray-800">
                                        üé£ C·∫ßn c√¢u: <span className="text-blue-600">{getRodName()}</span>
                                    </p>
                                    <p className="text-lg font-semibold text-gray-800">
                                        {baitInfo[currentBait].icon} M·ªìi: <span className="text-green-600">{baitInfo[currentBait].name}</span>
                                    </p>
                                </div>
                            </div>
                        )}

                        {gameState === 'fishing' && (
                            <div className="bg-white bg-opacity-90 rounded-lg p-12 shadow-2xl">
                                <h2 className="text-4xl font-bold text-blue-600 animate-pulse">
                                    C√° ƒë√£ c·∫Øn c√¢u! üé£
                                </h2>
                            </div>
                        )}

                        {gameState === 'question' && currentFish && (
                            <div className="bg-white rounded-lg p-8 shadow-2xl max-w-md">
                                <div className="mb-4 p-4 rounded-lg" style={{ backgroundColor: currentFish.color + '20' }}>
                                    <div className="flex justify-center mb-2">
                                        <FishIcon size={48} color={currentFish.color} />
                                    </div>
                                    <h2 className="text-2xl font-bold mb-2" style={{ color: currentFish.color }}>
                                        {currentFish.name}
                                    </h2>
                                    <p className="text-lg"><strong>ƒê·ªô hi·∫øm:</strong> {currentFish.rarity}</p>
                                    <p className="text-lg"><strong>C√¢n n·∫∑ng:</strong> {currentFish.weight} kg</p>
                                </div>

                                <div className="my-4 p-4 bg-gray-100 rounded-lg">
                                    <p className="text-sm text-purple-600 font-semibold mb-2">
                                        {baitInfo[currentBait].icon} S·ª≠ d·ª•ng: {baitInfo[currentBait].name}
                                    </p>
                                    <p className="text-3xl font-bold text-gray-800 mb-4">
                                        {currentFish.math.question} = ?
                                    </p>
                                    <p className="text-xl text-red-500 font-bold">
                                        Th·ªùi gian: {timeLeft}s
                                    </p>
                                </div>

                                <input
                                    type="number"
                                    value={answer}
                                    onChange={(e) => setAnswer(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && checkAnswer()}
                                    placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi"
                                    className="w-full px-4 py-3 text-xl border-2 border-gray-300 rounded-lg mb-4 text-center"
                                    autoFocus
                                />

                                <button
                                    onClick={checkAnswer}
                                    className="w-full px-6 py-3 bg-green-600 text-white text-xl rounded-lg hover:bg-green-700 transition"
                                >
                                    Tr·∫£ l·ªùi
                                </button>
                            </div>
                        )}

                        {gameState === 'result' && (
                            <div className="bg-white rounded-lg p-12 shadow-2xl max-w-md">
                                <p className="text-2xl font-bold text-gray-800">
                                    {message}
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FishingGame />);
    </script>
</body>
</html>




